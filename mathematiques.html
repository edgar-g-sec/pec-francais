<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Plan d‚Äô√©tude cantonal ‚Äî Math√©matiques (maquette)</title>

  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --border:#e6e8f0;
      --text:#111827;
      --muted:#6b7280;
      --shadow:0 10px 30px rgba(17,24,39,.06);
      --radius:16px;
      --radius2:12px;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:var(--bg);
      line-height:1.45;
    }
    a{color:#1d4ed8; text-decoration:none}
    a:hover{text-decoration:underline}

    .wrap{max-width:1200px;margin:24px auto;padding:0 16px 40px}

    /* Header */
    .header{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:18px 18px 14px;
      box-shadow:var(--shadow);
    }
    .title{margin:0 0 4px;font-size:26px;letter-spacing:-0.02em}
    .subtitle{margin:0;color:var(--muted);font-size:14px}

    /* Pills (comme capture) */
    .pills{display:flex;flex-wrap:wrap;gap:8px;padding:10px 0 0}
    .pill{
      border:1px solid var(--border);
      background:#fff;
      color:#374151;
      padding:7px 10px;
      border-radius:999px;
      font-size:13px;
      cursor:pointer;
      user-select:none;
      transition:.15s transform, .15s background, .15s border-color;
    }
    .pill:hover{transform:translateY(-1px)}
    .pill.active{
      border-color:#cfe0ff;
      background:#e8efff;
      color:#1d4ed8;
      font-weight:600;
    }

    /* Layout */
    .grid{
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:16px;
      margin-top:16px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
    }

    /* Sidebar */
    .side{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
      position:sticky;
      top:16px;
    }
    @media (max-width: 980px){ .side{position:relative; top:auto} }
    .side h3{margin:6px 0 10px;font-size:14px}
    .toc{margin:0;padding-left:16px;font-size:14px}
    .toc li{margin:6px 0}

    /* Sidebar pliable */
    .sideTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .sideBtns{display:flex; gap:8px}
    .sideBtn{
      border:1px solid var(--border);
      background:#fff;
      border-radius:10px;
      padding:7px 10px;
      font-size:12px;
      cursor:pointer;
      color:#374151;
    }
    .sideBtn:hover{background:#f3f6ff; border-color:#cfe0ff}
    #tocWrap.isHidden{display:none}

    /* Pliage horizontal */
    .grid.sidebarMini{
      grid-template-columns: 72px 1fr;
    }
    .grid.sidebarMini .side{padding:10px}
    .grid.sidebarMini .side h3,
    .grid.sidebarMini #tocWrap{display:none}
    .grid.sidebarMini .resourcesPanel{display:none !important}
    .grid.sidebarMini .sideTop{justify-content:center}
    .grid.sidebarMini .sideBtns{flex-direction:column}

    /* Main */
    .main{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
    }

    /* Section */
    .section{
      border:1px solid var(--border);
      border-radius:var(--radius);
      background:#fff;
      padding:14px;
      margin-bottom:12px;
    }
    .sectionHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .sectionTitle{
      display:flex;
      align-items:center;
      gap:10px;
      margin:0;
      font-weight:800;
      font-size:20px;
      letter-spacing:-0.02em;
    }
    .mini{margin:8px 0 0;color:var(--muted);font-size:13px}
    .muted{color:var(--muted)}

    /* Accordions (autres blocs) */
    details.accordion{
      border:1px solid var(--border);
      border-radius:12px;
      background:#fbfcff;
      margin-top:10px;
      overflow:hidden;
    }
    details.accordion > summary{
      list-style:none;
      cursor:pointer;
      padding:11px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      font-weight:700;
      user-select:none;
    }
    details.accordion > summary::-webkit-details-marker{display:none}
    .accBody{padding:0 12px 12px}
    .accBody p{margin:10px 0}
    .bullets{margin:8px 0 0; padding-left:18px}
    .bullets li{margin:6px 0}

    /* Chips / filters */
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .chip{
      border:1px solid var(--border);
      background:#fff;
      border-radius:999px;
      padding:6px 10px;
      font-size:13px;
      cursor:pointer;
      user-select:none;
    }
    .chip.active{
      background:#e8efff;
      border-color:#cfe0ff;
      color:#1d4ed8;
      font-weight:700;
    }

    /* Items */
    .items{margin-top:10px;border-top:1px solid var(--border);padding-top:10px}
    .item{
      padding:10px 10px;
      border:1px solid var(--border);
      border-radius:12px;
      margin:8px 0;
      background:#fff;
    }
    .itemTop{display:flex;align-items:flex-start;justify-content:space-between;gap:10px}
    .itemTitle{margin:0;font-weight:700}
    .badges{display:flex;flex-wrap:wrap;gap:6px;justify-content:flex-end;min-width:160px}
    .badge{
      font-family:var(--mono);
      font-size:12px;
      padding:3px 7px;
      border-radius:999px;
      border:1px solid var(--border);
      background:#fff;
      color:#111827;
      white-space:nowrap;
    }
    .note{
      border-left:3px solid #c7d2fe;
      padding:8px 10px;
      margin:10px 0;
      background:#f5f7ff;
      color:#1f2937;
      border-radius:10px;
      font-size:13px;
    }
    .k{
      font-family:var(--mono);
      background:#f3f4f6;
      padding:2px 6px;
      border-radius:8px;
      border:1px solid #e5e7eb;
    }
    .searchRow{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap;align-items:center}
    input[type="search"]{
      flex:1;min-width:240px;border:1px solid var(--border);
      border-radius:12px;padding:10px 12px;font-size:14px;outline:none;background:#fff;
    }
    input[type="search"]:focus{
      border-color:#cfe0ff;
      box-shadow:0 0 0 4px rgba(37,99,235,.08);
    }

    /* --------- Comp√©tences (style capture) --------- */
    .competences{margin-top:10px;border-top:1px solid var(--border);padding-top:10px}

    details.comp{
      border:1px solid var(--border);
      border-radius:14px;
      background:#fff;
      overflow:hidden;
      margin:10px 0;
    }
    details.comp > summary{
      list-style:none;
      cursor:pointer;
      user-select:none;
      padding:12px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      font-weight:800;
      letter-spacing:-0.01em;
    }
    details.comp > summary::-webkit-details-marker{display:none}

    .compLeft{display:flex;align-items:flex-start;gap:10px;min-width:0}
    .chev{
      width:18px;height:18px;
      display:inline-flex;align-items:center;justify-content:center;
      color:var(--muted);
      transform: translateY(2px);
      font-size:14px;
    }
    details.comp[open] .chev{ transform: translateY(2px) rotate(90deg); }
    .compTitle{margin:0;font-size:15px;line-height:1.25}
    .compBody{padding:0 12px 12px}
    .subpoints{margin:8px 0 0;padding-left:20px;color:#111827;font-size:14px}
    .subpoints li{margin:8px 0}

    .trait{
      height:1px;
      background:linear-gradient(to right, transparent, #e6e8f0, transparent);
      margin:10px 0;
    }

    .c1{ --accent:#2563eb; --accentSoft:#e8efff; }
    .c2{ --accent:#16a34a; --accentSoft:#e8fff1; }
    .c3{ --accent:#f59e0b; --accentSoft:#fff6e6; }
    .c4{ --accent:#7c3aed; --accentSoft:#f3e8ff; }
    .c5{ --accent:#ef4444; --accentSoft:#ffecec; }

    details.comp.c1 > summary, details.comp.c2 > summary, details.comp.c3 > summary, details.comp.c4 > summary, details.comp.c5 > summary{
      background: linear-gradient(90deg, var(--accentSoft), #ffffff 65%);
    }
    details.comp.c1 .badge, details.comp.c2 .badge, details.comp.c3 .badge, details.comp.c4 .badge, details.comp.c5 .badge{
      border-color:#dbe2ff;
      background:#fff;
    }
    @supports (background: color-mix(in srgb, red 50%, white)){
      details.comp.c1 .badge, details.comp.c2 .badge, details.comp.c3 .badge, details.comp.c4 .badge, details.comp.c5 .badge{
        border-color: color-mix(in srgb, var(--accent) 25%, #e6e8f0);
        background: color-mix(in srgb, var(--accentSoft) 60%, #ffffff);
      }
    }

    /* --------- Ressources panel --------- */
    .resourcesPanel{
      margin-top:12px;
      border-top:1px solid var(--border);
      padding-top:12px;
    }
    .resHead{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .resTitle{font-weight:800;font-size:14px}
    .resSub{color:var(--muted);font-size:12px;margin-top:2px}
    .resList{display:flex;flex-direction:column;gap:8px}

    .resItem{
      display:flex;
      gap:10px;
      align-items:flex-start;
      border:1px solid var(--border);
      border-radius:12px;
      padding:10px;
      background:#fff;
    }
    .resIcon{
      width:34px;height:34px;
      border-radius:10px;
      border:1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:center;
      background:#fbfcff;
      font-size:16px;
      flex:0 0 auto;
    }
    .resBody{min-width:0}
    .resName{font-weight:700;margin:0;font-size:13px}
    .resMeta{margin:2px 0 0;color:var(--muted);font-size:12px}
    .resLink{
      display:inline-block;
      margin-top:6px;
      font-size:12px;
      color:#1d4ed8;
      text-decoration:none;
    }
    .resLink:hover{text-decoration:underline}
  </style>
</head>

<body>
  <div class="wrap">
    <header class="header" id="top">
      <h1 class="title">Plan d‚Äô√©tude cantonal ‚Äî Math√©matiques</h1>
      <p class="subtitle">Coll√®ge de Gen√®ve ‚Äî version ‚Äúweb‚Äù (travail en cours)</p>
      <div class="pills" id="topPills"></div>
    </header>

    <div class="grid" id="grid">
      <!-- Sidebar (sommaire + ressources) -->
      <aside class="side" id="sidebar">
        <div class="sideTop">
          <h3>Sommaire</h3>

          <div class="sideBtns">
            <button class="sideBtn" id="btnCollapseV" type="button">Replier</button>
            <button class="sideBtn" id="btnCollapseH" type="button">‚áî</button>
          </div>
        </div>

        <div id="tocWrap">
          <ul class="toc" id="toc"></ul>
        </div>

        <!-- Ressources (cach√© tant qu‚Äôaucune comp√©tence n‚Äôest s√©lectionn√©e) -->
        <div class="resourcesPanel" id="resourcesPanel" hidden>
          <div class="resHead">
            <div>
              <div class="resTitle">Ressources</div>
              <div class="resSub" id="resFor">Pour : ‚Äî</div>
            </div>
            <button class="sideBtn" id="btnCloseRes" type="button">Fermer</button>
          </div>

          <div class="resList" id="resList"></div>
        </div>
      </aside>

      <!-- Main -->
      <main class="main" id="content"></main>
    </div>
  </div>

<script>
/* --- Donn√©es (maquette) --- */
const DATA = {
  nav: [
    { id:"competences", label:"Comp√©tences cl√©s" },
    { id:"progression", label:"Progression (1re ‚Üí 4e)" },
    { id:"decoupages", label:"D√©coupages annuels" },
    { id:"acquisCO", label:"Acquis du CO" },
    { id:"phase2", label:"Phase 2 : IA & num√©rique" },
    { id:"phase3", label:"Phase 3 : transversalit√©" }
  ],

  progressionParAnnee: [
    { annee:"1re ann√©e", points:[
      "Calculer avec entiers, rationnels et r√©els.",
      "R√©soudre √©quations/in√©quations (1er, 2e degr√© + factorisation).",
      "D√©velopper / r√©duire / factoriser.",
      "Repr√©senter fonctions √©l√©mentaires (dont 1er et 2e degr√©s).",
      "G√©om√©trie (angles, triangles, Pythagore, Thal√®s, cercles).",
      "Trigonom√©trie triangle rectangle."
    ]},
    { annee:"2e ann√©e", points:[
      "G√©om√©trie cart√©sienne (droites, cercles).",
      "Trigonom√©trie triangle quelconque.",
      "Statistiques (moyenne, m√©diane, variance, √©cart-type).",
      "√âquations et fonctions : polynomiales, rationnelles, exponentielles, logarithmiques, trigonom√©triques.",
      "Calcul vectoriel de base."
    ]},
    { annee:"3e ann√©e", points:[
      "Suites (terme g√©n√©ral, somme arithm./g√©om.).",
      "Limites, d√©riv√©es, √©tude de fonctions, optimisation.",
      "Combinatoire.",
      "Probabilit√©s discr√®tes (conditionnelle, binomiale).",
      "Produit scalaire, droites/plans (plan & espace)."
    ]},
    { annee:"4e ann√©e", points:[
      "Primitives, int√©grales, probl√®mes via calcul int√©gral.",
      "√âquations diff√©rentielles simples.",
      "Produit vectoriel & distances (plan/espace).",
      "Intervalles de confiance & tests statistiques.",
      "Probabilit√©s continues (loi normale)."
    ]}
  ],

  decoupages: {
    annee: "Premi√®re ann√©e (niveau normal) ‚Äî exemple",
    chapitres: [
      {
        id:"A1-CH1",
        titre:"Chapitre 1 : Calcul num√©rique et alg√©brique",
        items: [
          { titre:"D√©finir les ensembles de nombres (N, Z, Q ‚Üí approche R), puissances enti√®res et racines carr√©es", tags:["C2","CdB"] },
          { titre:"Conna√Ætre le vocabulaire et les notations du calcul num√©rique et de la th√©orie des ensembles (liste du minimum commun)", tags:["C3","CdB"] },
          { titre:"Calculer avec les nombres entiers et relatifs (priorit√©s, parenth√®ses, signes, fractions)", tags:["C1","L"] },
          { titre:"Diff√©rencier nombres, constantes et variables", tags:["C2","CdB"] },
          { titre:"Lire et utiliser les notations alg√©briques (liste des notations communes)", tags:["C3"] },
          { titre:"Calculer avec les puissances enti√®res et les racines carr√©es", tags:["C1","CdB"] },
          { titre:"Analyser la structure de termes alg√©briques", tags:["C3"] },
          { titre:"Effectuer des calculs alg√©briques : d√©velopper, r√©duire, factoriser", tags:["C2"] },
          { titre:"Construction math√©matique : d√©f./conjecture/contre-exemple/d√©monstration/th√©or√®me/r√©ciproque/contrapos√©e + produire des conjectures simples", tags:["C2"] },
          { titre:"D√©monstration : propri√©t√©s des puissances, racines, irrationalit√© de ‚àö2, identit√©s remarquables", tags:["C2"] },
          { titre:"√âl√©ments d‚Äôhistoire des nombres et de l‚Äôalg√®bre (liste du minimum commun)", tags:["C4","L"] }
        ]
      }
    ]
  },

  acquisCO: [
    { bloc:"FA ‚Äî Calcul litt√©ral", items:[
      "Conna√Ætre le vocabulaire li√© au calcul litt√©ral",
      "Conna√Ætre et utiliser les conventions du calcul litt√©ral",
      "Calculer avec mon√¥mes et polyn√¥mes",
      "√âvaluer une expression litt√©rale",
      "Transformer des formules simples (isoler une variable)",
      "D√©velopper (identit√©s remarquables, distributivit√©)",
      "Factoriser (mise en √©vidence, identit√©s remarquables)",
      "Traduire programme de calcul ‚Üî expression litt√©rale"
    ]},
    { bloc:"FA ‚Äî Premier degr√©", items:[
      "Vocabulaire fonctions affines/lin√©aires/constantes",
      "Repr√©senter une affine (pente & ordonn√©e √† l‚Äôorigine)",
      "Repr√©senter une affine (2 points)",
      "Retrouver l‚Äôexpression d‚Äôune affine depuis le graphe (pente fractionnaire)",
      "Parall√©lisme / perpendicularit√©",
      "R√©soudre √©quation du 1er degr√© (coefficients fractionnaires)",
      "Traduire un probl√®me en √©quation du 1er degr√©",
      "Image, pr√©image, intersections avec Ox/Oy"
    ]},
    { bloc:"NO ‚Äî Calcul num√©rique", items:[
      "Calculer efficacement (4 op√©rations, priorit√©s) sur entiers relatifs, d√©cimaux, rationnels",
      "Comparer deux nombres",
      "Notation scientifique : d√©finition + calculs",
      "R√®gles de calcul des puissances enti√®res",
      "Racines carr√©es et cubiques + propri√©t√©s"
    ]},
    { bloc:"GM ‚Äî G√©om√©trie (Pythagore & figures)", items:[
      "Th√©or√®me de Pythagore (direct, r√©ciproque, contrapos√©e)",
      "Utiliser Pythagore pour longueur manquante / tester rectangle / dans l‚Äôespace",
      "P√©rim√®tres (figures simples, polygones par d√©composition)",
      "Aires (figures simples, polygones par d√©composition)",
      "Cercle : p√©rim√®tre & aire, longueur d‚Äôarc, secteur"
    ]}
  ],

  phase2: { note:"Section indiqu√©e comme √† d√©velopper : Enjeux IA, place √† donner √† l‚ÄôIA, ressources num√©riques." },
  phase3: { note:"Section indiqu√©e comme √† d√©velopper : ajout de transversalit√©." }
};

/* Ressources (exemples) */
DATA.ressourcesParCompetence = {
  C1: [
    { type:"pdf",   name:"Fiche ‚Äî Bases de la d√©marche d√©ductive", meta:"PDF ‚Ä¢ 6 pages", href:"#"},
    { type:"video", name:"Vid√©o ‚Äî Preuve & contre-exemple (intro)", meta:"Vid√©o ‚Ä¢ 8 min", href:"#"},
    { type:"web",   name:"Article ‚Äî R√©ciproque vs contrapos√©e", meta:"Lien web", href:"#"},
  ],
  C2: [
    { type:"pdf",   name:"M√©mo ‚Äî Techniques alg√©briques essentielles", meta:"PDF ‚Ä¢ 4 pages", href:"#"},
    { type:"web",   name:"Outil ‚Äî Calculatrice CAS (simulateur)", meta:"Lien web", href:"#"},
    { type:"video", name:"Vid√©o ‚Äî V√©rifier la coh√©rence d‚Äôun r√©sultat", meta:"Vid√©o ‚Ä¢ 5 min", href:"#"},
  ],
  C3: [
    { type:"pdf",   name:"Guide ‚Äî Mod√©liser (sch√©ma / alg√®bre / graphe)", meta:"PDF ‚Ä¢ 5 pages", href:"#"},
    { type:"activity", name:"Activit√© ‚Äî M√©thodes standards de r√©solution", meta:"Exercices ‚Ä¢ 20 min", href:"#"},
    { type:"web",   name:"Banque ‚Äî Probl√®mes contextualis√©s", meta:"Lien web", href:"#"},
  ],
  C4: [
    { type:"pdf",   name:"Conventions ‚Äî Notations (CRM)", meta:"PDF ‚Ä¢ 3 pages", href:"#"},
    { type:"video", name:"Vid√©o ‚Äî Expliquer un raisonnement √† l‚Äôoral", meta:"Vid√©o ‚Ä¢ 7 min", href:"#"},
    { type:"web",   name:"Ressource ‚Äî Choisir le bon registre", meta:"Lien web", href:"#"},
  ],
  C5: [
    { type:"web",   name:"Dossier ‚Äî Maths & autres disciplines", meta:"Lien web", href:"#"},
    { type:"pdf",   name:"Chronologie ‚Äî Grandes √©tapes historiques", meta:"PDF ‚Ä¢ 2 pages", href:"#"},
    { type:"video", name:"Vid√©o ‚Äî Enjeux sociaux des applications", meta:"Vid√©o ‚Ä¢ 10 min", href:"#"},
  ]
};

/* --- Helpers --- */
const elPills = document.getElementById("topPills");
const elToc   = document.getElementById("toc");
const elMain  = document.getElementById("content");

let state = { viewId: "competences", chapterFilter: new Set(["ALL"]), query: "" };

function h(tag, attrs={}, children=[]){
  const e = document.createElement(tag);
  for (const [k,v] of Object.entries(attrs)){
    if (k === "class") e.className = v;
    else if (k === "html") e.innerHTML = v;
    else if (k.startsWith("on") && typeof v === "function") e.addEventListener(k.slice(2), v);
    else e.setAttribute(k, v);
  }
  for (const c of children){
    if (c === null || c === undefined) continue;
    e.appendChild(typeof c === "string" ? document.createTextNode(c) : c);
  }
  return e;
}
function scrollToId(id){
  const target = document.getElementById(id);
  if (!target) return;
  target.scrollIntoView({behavior:"smooth", block:"start"});
}

/* --- Top pills + TOC --- */
function renderPills(){
  elPills.innerHTML = "";
  DATA.nav.forEach(n=>{
    elPills.appendChild(
      h("button", {
        class:"pill" + (state.viewId===n.id ? " active":""),
        type:"button",
        onclick: () => { state.viewId=n.id; renderAll(false); scrollToId(n.id); }
      }, [n.label])
    );
  });
}
function renderToc(){
  elToc.innerHTML = "";
  DATA.nav.forEach(n=>{
    elToc.appendChild(
      h("li", {}, [
        h("a", {href:"#"+n.id, onclick:(ev)=>{ev.preventDefault(); state.viewId=n.id; renderAll(false); scrollToId(n.id);} }, [n.label])
      ])
    );
  });
}

/* --- Ressources panel --- */
function iconFor(type){
  if(type==="pdf") return "üìÑ";
  if(type==="video") return "‚ñ∂Ô∏è";
  if(type==="web") return "üîó";
  if(type==="activity") return "üß©";
  return "üìå";
}
function showResourcesFor(compCode){
  const panel = document.getElementById("resourcesPanel");
  const list  = document.getElementById("resList");
  const resFor= document.getElementById("resFor");

  const res = (DATA.ressourcesParCompetence && DATA.ressourcesParCompetence[compCode]) || [];
  if(res.length === 0){
    panel.hidden = true;
    return;
  }

  resFor.textContent = `Pour : ${compCode}`;
  list.innerHTML = "";

  res.forEach(r=>{
    const item = h("div", {class:"resItem"}, [
      h("div", {class:"resIcon", title:r.type}, [iconFor(r.type)]),
      h("div", {class:"resBody"}, [
        h("p", {class:"resName"}, [r.name]),
        h("p", {class:"resMeta"}, [r.meta || ""]),
        h("a", {class:"resLink", href:r.href || "#", target:"_blank", rel:"noopener"}, ["Ouvrir"])
      ])
    ]);
    list.appendChild(item);
  });

  panel.hidden = false;
}
function hideResources(){
  const panel = document.getElementById("resourcesPanel");
  panel.hidden = true;
}
document.getElementById("btnCloseRes").addEventListener("click", hideResources);

/* Sommaire pliable verticalement */
document.getElementById("btnCollapseV").addEventListener("click", ()=>{
  const tocWrap = document.getElementById("tocWrap");
  const isHidden = tocWrap.classList.toggle("isHidden");
  document.getElementById("btnCollapseV").textContent = isHidden ? "D√©plier" : "Replier";
});

/* Sommaire pliable horizontalement */
document.getElementById("btnCollapseH").addEventListener("click", ()=>{
  document.getElementById("grid").classList.toggle("sidebarMini");
});

/* --- Sections --- */
function renderSectionCompetences(){
  return h("section", {class:"section", id:"competences"}, [
    h("div", {class:"sectionHead"}, [
      h("h2", {class:"sectionTitle"}, ["‚ñº Comp√©tences cl√©s en math√©matiques"]),
      h("p", {class:"mini"}, ["Clique sur une comp√©tence pour afficher la d√©clinaison (a, b, c‚Ä¶) et les ressources √† gauche."])
    ]),

    h("div", {class:"competences"}, [
      h("details", {class:"comp c1", open:true, "data-comp":"C1"}, [
        h("summary", {}, [
          h("div", {class:"compLeft"}, [
            h("span", {class:"chev"}, ["‚ñ∂"]),
            h("p", {class:"compTitle"}, ["C1 ‚Äî Raisonner de fa√ßon argument√©e et rigoureuse"])
          ]),
          h("span", {class:"badge"}, ["C1"])
        ]),
        h("div", {class:"compBody"}, [
          h("ol", {class:"subpoints", type:"a"}, [
            h("li", {}, ["Acqu√©rir les bases de la d√©marche d√©ductive : d√©finition, axiome, conjecture, d√©monstration, th√©or√®me, hypoth√®se, conclusion, contre-exemple, implication, r√©ciproque, contrapos√©e."]),
            h("li", {}, ["√ätre capable de comprendre, critiquer et restituer un raisonnement math√©matique ou logique."]),
            h("li", {}, ["Produire une pens√©e logique et abstraite structur√©e."])
          ])
        ])
      ]),

      h("div", {class:"trait"}, []),

      h("details", {class:"comp c2", "data-comp":"C2"}, [
        h("summary", {}, [
          h("div", {class:"compLeft"}, [
            h("span", {class:"chev"}, ["‚ñ∂"]),
            h("p", {class:"compTitle"}, ["C2 ‚Äî Ma√Ætriser les savoir-faire techniques en math√©matiques"])
          ]),
          h("span", {class:"badge"}, ["C2"])
        ]),
        h("div", {class:"compBody"}, [
          h("ol", {class:"subpoints", type:"a"}, [
            h("li", {}, ["Savoir utiliser les fondamentaux de niveau gymnasial en arithm√©tique, alg√®bre, analyse, g√©om√©trie, logique, probabilit√©s et statistiques."]),
            h("li", {}, ["D√©velopper des strat√©gies pour porter un regard critique dynamique sur un processus de r√©solution : pr√©voir, analyser et v√©rifier la coh√©rence d‚Äôun r√©sultat."]),
            h("li", {}, ["Utiliser efficacement les moyens num√©riques √† disposition."])
          ])
        ])
      ]),

      h("div", {class:"trait"}, []),

      h("details", {class:"comp c3", "data-comp":"C3"}, [
        h("summary", {}, [
          h("div", {class:"compLeft"}, [
            h("span", {class:"chev"}, ["‚ñ∂"]),
            h("p", {class:"compTitle"}, ["C3 ‚Äî Appr√©hender un probl√®me √† l‚Äôaide des outils math√©matiques"])
          ]),
          h("span", {class:"badge"}, ["C3"])
        ]),
        h("div", {class:"compBody"}, [
          h("ol", {class:"subpoints", type:"a"}, [
            h("li", {}, ["Mod√©liser un probl√®me en mobilisant le registre ad√©quat (sch√©matique, alg√©brique, graphique)."]),
            h("li", {}, ["Appliquer des m√©thodes standards de r√©solution de probl√®mes (se ramener √† un cas connu, √©tudier un cas particulier, introduire un √©l√©ment auxiliaire, etc.) et choisir les savoir-faire techniques ad√©quats."]),
            h("li", {}, ["Porter un regard critique et interpr√©ter des r√©sultats dans diff√©rents contextes (notamment √©valuer la pr√©cision attendue) dans une r√©ponse (valeur exacte, arrondi, chiffres significatifs)."])
          ])
        ])
      ]),

      h("div", {class:"trait"}, []),

      h("details", {class:"comp c4", "data-comp":"C4"}, [
        h("summary", {}, [
          h("div", {class:"compLeft"}, [
            h("span", {class:"chev"}, ["‚ñ∂"]),
            h("p", {class:"compTitle"}, ["C4 ‚Äî Communiquer √† l‚Äô√©crit et √† l‚Äôoral en s‚Äôappuyant sur le langage symbolique et graphique"])
          ]),
          h("span", {class:"badge"}, ["C4"])
        ]),
        h("div", {class:"compBody"}, [
          h("ol", {class:"subpoints", type:"a"}, [
            h("li", {}, ["Utiliser de fa√ßon pr√©cise les notations, symboles et d√©finitions math√©matiques selon les conventions d√©finies par la Commission Romande de Math√©matique."]),
            h("li", {}, ["Utiliser les diff√©rents registres de repr√©sentations (graphique, alg√©brique, sch√©matique et textuel) selon leur pertinence."]),
            h("li", {}, ["Produire une argumentation claire et structur√©e, √† l‚Äô√©crit et √† l‚Äôoral."])
          ])
        ])
      ]),

      h("div", {class:"trait"}, []),

      h("details", {class:"comp c5", "data-comp":"C5"}, [
        h("summary", {}, [
          h("div", {class:"compLeft"}, [
            h("span", {class:"chev"}, ["‚ñ∂"]),
            h("p", {class:"compTitle"}, ["C5 ‚Äî Inscrire les math√©matiques dans l‚Äôhistoire, identifier des liens avec les autres disciplines et des enjeux actuels"])
          ]),
          h("span", {class:"badge"}, ["C5"])
        ]),
        h("div", {class:"compBody"}, [
          h("ol", {class:"subpoints", type:"a"}, [
            h("li", {}, ["Transposer les math√©matiques dans les autres disciplines (en particulier biologie, chimie, √©conomie, g√©ographie, informatique, physique)."]),
            h("li", {}, ["Avoir une vision des math√©matiques dans une perspective historique (conna√Ætre quelques grandes √©tapes et personnages historiques)."]),
            h("li", {}, ["Avoir une vision des math√©matiques dans une perspective sociale, de leur utilit√© et des applications possibles, y compris en termes d‚Äôenjeux sociaux."]),
            h("li", {}, ["D√©velopper une sensibilit√© √† l‚Äô√©l√©gance intrins√®que des math√©matiques."])
          ])
        ])
      ])
    ])
  ]);
}

function renderSectionProgression(){
  return h("section", {class:"section", id:"progression"}, [
    h("div", {class:"sectionHead"}, [
      h("h2", {class:"sectionTitle"}, ["‚ñº Progression (1re ‚Üí 4e)"]),
      h("div", {class:"muted"}, [""])
    ]),
    h("p", {class:"mini"}, ["Vue synth√®se par ann√©e (√† enrichir)."]),
    ...DATA.progressionParAnnee.map(a =>
      h("details", {class:"accordion", open:false}, [
        h("summary", {}, [a.annee, h("span",{class:"muted"},["‚ñº"])]),
        h("div", {class:"accBody"}, [
          h("ul", {class:"bullets"}, a.points.map(x=>h("li",{},[x])))
        ])
      ])
    )
  ]);
}

function normalizeTags(tags){ return tags.map(t=>t.trim()); }
function itemMatchesFilters(item){
  const q = state.query.trim().toLowerCase();
  if (q && !item.titre.toLowerCase().includes(q)) return false;

  const active = [...state.chapterFilter];
  if (active.includes("ALL")) return true;

  const tags = normalizeTags(item.tags || []);
  return active.some(f => tags.includes(f));
}

function renderSectionDecoupages(){
  const chapter = DATA.decoupages.chapitres[0];
  const allFilters = ["ALL","C1","C2","C3","C4","C5","CdB","L","T","N"];

  return h("section", {class:"section", id:"decoupages"}, [
    h("div", {class:"sectionHead"}, [
      h("h2", {class:"sectionTitle"}, ["‚ñº D√©coupages annuels / Vues dynamiques"]),
      h("div", {class:"muted"}, [""])
    ]),
    h("p", {class:"mini"}, [
      DATA.decoupages.annee, " ‚Äî ", h("span",{class:"k"},["exemple"]), " : filtrage par comp√©tence / tags."
    ]),
    h("details", {class:"accordion", open:true}, [
      h("summary", {}, [chapter.titre, h("span",{class:"muted"},["‚ñ≤"])]),
      h("div", {class:"accBody"}, [
        h("div", {class:"searchRow"}, [
          h("input", {
            type:"search",
            placeholder:"Rechercher dans le chapitre‚Ä¶ (ex: ‚Äúracines‚Äù, ‚Äúd√©monstration‚Äù)",
            value: state.query,
            oninput:(ev)=>{ state.query = ev.target.value; renderAll(false); }
          }),
          h("span", {class:"muted"}, ["Astuce : clique sur C1/C2/‚Ä¶ pour reproduire les ‚ÄúVues disponibles‚Äù."])
        ]),
        h("div", {class:"chips"}, allFilters.map(f => {
          const active = state.chapterFilter.has(f);
          return h("button", {
            class:"chip" + (active ? " active":""),
            type:"button",
            onclick:()=>{
              if (f === "ALL"){
                state.chapterFilter = new Set(["ALL"]);
              } else {
                if (state.chapterFilter.has("ALL")) state.chapterFilter.delete("ALL");
                if (state.chapterFilter.has(f)) state.chapterFilter.delete(f);
                else state.chapterFilter.add(f);
                if (state.chapterFilter.size === 0) state.chapterFilter.add("ALL");
              }
              renderAll(false);
            }
          }, [f]);
        })),
        h("div", {class:"items", id:"chapterItems"})
      ])
    ])
  ]);
}

function renderChapterItems(){
  const holder = document.getElementById("chapterItems");
  if (!holder) return;
  holder.innerHTML = "";

  const chapter = DATA.decoupages.chapitres[0];
  const filtered = chapter.items.filter(itemMatchesFilters);

  holder.appendChild(
    h("p", {class:"mini"}, [
      "R√©sultats : ",
      h("strong", {}, [String(filtered.length)]),
      " / ",
      String(chapter.items.length),
      " ‚Äî filtres actifs : ",
      h("span",{class:"k"}, [[...state.chapterFilter].join(", ")]),
      state.query.trim() ? (" ‚Äî recherche : ‚Äú" + state.query.trim() + "‚Äù") : ""
    ])
  );

  filtered.forEach(it=>{
    holder.appendChild(
      h("div", {class:"item"}, [
        h("div", {class:"itemTop"}, [
          h("p", {class:"itemTitle"}, [it.titre]),
          h("div", {class:"badges"}, (it.tags||[]).map(t=>h("span",{class:"badge"},[t])))
        ])
      ])
    );
  });

  if (filtered.length === 0){
    holder.appendChild(h("div",{class:"note"},[
      "Aucun item ne correspond √† ces filtres/recherche. ",
      h("span",{class:"muted"},["(Essaie ALL ou enl√®ve un filtre.)"])
    ]));
  }
}

function renderSectionAcquisCO(){
  return h("section", {class:"section", id:"acquisCO"}, [
    h("div", {class:"sectionHead"}, [
      h("h2", {class:"sectionTitle"}, ["‚ñº Acquis du CO (r√©f√©rence)"]),
      h("div", {class:"muted"}, [""])
    ]),
    h("p", {class:"mini"}, ["R√©f√©rentiel d‚Äôentr√©e (acquis avant le coll√®ge)."]),
    ...DATA.acquisCO.map(b =>
      h("details", {class:"accordion", open:false}, [
        h("summary", {}, [b.bloc, h("span",{class:"muted"},["‚ñº"])]),
        h("div", {class:"accBody"}, [
          h("ul", {class:"bullets"}, b.items.map(x=>h("li",{},[x])))
        ])
      ])
    )
  ]);
}

function renderSectionPhase2(){
  return h("section", {class:"section", id:"phase2"}, [
    h("div", {class:"sectionHead"}, [
      h("h2", {class:"sectionTitle"}, ["‚ñº Phase 2 : IA et num√©rique"]),
      h("div", {class:"muted"}, [""])
    ]),
    h("div", {class:"note"}, [DATA.phase2.note])
  ]);
}
function renderSectionPhase3(){
  return h("section", {class:"section", id:"phase3"}, [
    h("div", {class:"sectionHead"}, [
      h("h2", {class:"sectionTitle"}, ["‚ñº Phase 3 : transversalit√©"]),
      h("div", {class:"muted"}, [""])
    ]),
    h("div", {class:"note"}, [DATA.phase3.note])
  ]);
}

/* --- Render all --- */
function renderAll(doScroll){
  renderPills();
  renderToc();

  elMain.innerHTML = "";
  elMain.appendChild(renderSectionCompetences());
  elMain.appendChild(renderSectionProgression());
  elMain.appendChild(renderSectionDecoupages());
  elMain.appendChild(renderSectionAcquisCO());
  elMain.appendChild(renderSectionPhase2());
  elMain.appendChild(renderSectionPhase3());

  renderChapterItems();
  wireCompetences();

  if (doScroll) scrollToId(state.viewId);
}

/* Interactions : 1 comp√©tence ouverte √† la fois + ressources √† gauche */
function wireCompetences(){
  document.querySelectorAll('details.comp').forEach(d => {
    // Evite de doubler les listeners si renderAll est appel√© plusieurs fois
    if (d.__wired) return;
    d.__wired = true;

    d.addEventListener('toggle', () => {
      const code = d.getAttribute("data-comp");

      if (d.open){
        document.querySelectorAll('details.comp').forEach(other => {
          if (other !== d) other.open = false;
        });
        if(code) showResourcesFor(code);
      } else {
        hideResources();
      }
    });
  });
}

/* Init */
renderAll(false);
/* Affiche les ressources de C1 (ouverte par d√©faut) */
showResourcesFor("C1");
</script>
</body>
</html>
