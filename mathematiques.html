<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Plan d’étude cantonal — Mathématiques (maquette)</title>

  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --border:#e6e8f0;
      --text:#111827;
      --muted:#6b7280;
      --shadow:0 10px 30px rgba(17,24,39,.06);
      --radius:16px;
      --radius2:12px;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:var(--bg);
      line-height:1.45;
    }
    a{color:#1d4ed8; text-decoration:none}
    a:hover{text-decoration:underline}

    .wrap{max-width:1200px;margin:24px auto;padding:0 16px 40px}

    /* Header */
    .header{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:18px 18px 14px;
      box-shadow:var(--shadow);
    }
    .title{margin:0 0 4px;font-size:26px;letter-spacing:-0.02em}
    .subtitle{margin:0;color:var(--muted);font-size:14px}

    /* Pills (comme capture) */
    .pills{display:flex;flex-wrap:wrap;gap:8px;padding:10px 0 0}
    .pill{
      border:1px solid var(--border);
      background:#fff;
      color:#374151;
      padding:7px 10px;
      border-radius:999px;
      font-size:13px;
      cursor:pointer;
      user-select:none;
      transition:.15s transform, .15s background, .15s border-color;
    }
    .pill:hover{transform:translateY(-1px)}
    .pill.active{
      border-color:#cfe0ff;
      background:#e8efff;
      color:#1d4ed8;
      font-weight:600;
    }

    /* Layout */
    .grid{
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:16px;
      margin-top:16px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
    }

    /* Sidebar */
    .side{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
      position:sticky;
      top:16px;
    }
    @media (max-width: 980px){ .side{position:relative; top:auto} }
    .side h3{margin:6px 0 10px;font-size:14px}
    .toc{margin:0;padding-left:16px;font-size:14px}
    .toc li{margin:6px 0}

    /* Main */
    .main{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
    }

    /* Section */
    .section{
      border:1px solid var(--border);
      border-radius:var(--radius);
      background:#fff;
      padding:14px;
      margin-bottom:12px;
    }
    .sectionHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .sectionTitle{
      display:flex;
      align-items:center;
      gap:10px;
      margin:0;
      font-weight:800;
      font-size:20px;
      letter-spacing:-0.02em;
    }
    .mini{margin:8px 0 0;color:var(--muted);font-size:13px}

    /* Accordions (autres blocs) */
    details.accordion{
      border:1px solid var(--border);
      border-radius:12px;
      background:#fbfcff;
      margin-top:10px;
      overflow:hidden;
    }
    details.accordion > summary{
      list-style:none;
      cursor:pointer;
      padding:11px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      font-weight:700;
      user-select:none;
    }
    details.accordion > summary::-webkit-details-marker{display:none}
    .accBody{padding:0 12px 12px}
    .accBody p{margin:10px 0}
    .bullets{margin:8px 0 0; padding-left:18px}
    .bullets li{margin:6px 0}

    /* Chips / filters */
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .chip{
      border:1px solid var(--border);
      background:#fff;
      border-radius:999px;
      padding:6px 10px;
      font-size:13px;
      cursor:pointer;
      user-select:none;
    }
    .chip.active{
      background:#e8efff;
      border-color:#cfe0ff;
      color:#1d4ed8;
      font-weight:700;
    }

    /* Items */
    .items{margin-top:10px;border-top:1px solid var(--border);padding-top:10px}
    .item{
      padding:10px 10px;
      border:1px solid var(--border);
      border-radius:12px;
      margin:8px 0;
      background:#fff;
    }
    .itemTop{display:flex;align-items:flex-start;justify-content:space-between;gap:10px}
    .itemTitle{margin:0;font-weight:700}
    .badges{display:flex;flex-wrap:wrap;gap:6px;justify-content:flex-end;min-width:160px}
    .badge{
      font-family:var(--mono);
      font-size:12px;
      padding:3px 7px;
      border-radius:999px;
      border:1px solid var(--border);
      background:#fff;
      color:#111827;
      white-space:nowrap;
    }
    .note{
      border-left:3px solid #c7d2fe;
      padding:8px 10px;
      margin:10px 0;
      background:#f5f7ff;
      color:#1f2937;
      border-radius:10px;
      font-size:13px;
    }
    .k{
      font-family:var(--mono);
      background:#f3f4f6;
      padding:2px 6px;
      border-radius:8px;
      border:1px solid #e5e7eb;
    }
    .searchRow{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap;align-items:center}
    input[type="search"]{
      flex:1;min-width:240px;border:1px solid var(--border);
      border-radius:12px;padding:10px 12px;font-size:14px;outline:none;background:#fff;
    }
    input[type="search"]:focus{
      border-color:#cfe0ff;
      box-shadow:0 0 0 4px rgba(37,99,235,.08);
    }

    /* --------- NOUVEAU : Compétences (style capture) --------- */
    .competences{margin-top:10px;border-top:1px solid var(--border);padding-top:10px}

    details.comp{
      border:1px solid var(--border);
      border-radius:14px;
      background:#fff;
      overflow:hidden;
      margin:10px 0;
    }
    details.comp > summary{
      list-style:none;
      cursor:pointer;
      user-select:none;
      padding:12px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      font-weight:800;
      letter-spacing:-0.01em;
    }
    details.comp > summary::-webkit-details-marker{display:none}

    .compLeft{display:flex;align-items:flex-start;gap:10px;min-width:0}
    .chev{
      width:18px;height:18px;
      display:inline-flex;align-items:center;justify-content:center;
      color:var(--muted);
      transform: translateY(2px);
      font-size:14px;
    }
    details.comp[open] .chev{ transform: translateY(2px) rotate(90deg); }

    .compTitle{margin:0;font-size:15px;line-height:1.25}

    .compBody{padding:0 12px 12px}
    .subpoints{margin:8px 0 0;padding-left:20px;color:#111827;font-size:14px}
    .subpoints li{margin:8px 0}

    .trait{
      height:1px;
      background:linear-gradient(to right, transparent, #e6e8f0, transparent);
      margin:10px 0;
    }

    .c1{ --accent:#2563eb; --accentSoft:#e8efff; }
    .c2{ --accent:#16a34a; --accentSoft:#e8fff1; }
    .c3{ --accent:#f59e0b; --accentSoft:#fff6e6; }
    .c4{ --accent:#7c3aed; --accentSoft:#f3e8ff; }
    .c5{ --accent:#ef4444; --accentSoft:#ffecec; }

    details.comp.c1 > summary, details.comp.c2 > summary, details.comp.c3 > summary, details.comp.c4 > summary, details.comp.c5 > summary{
      background: linear-gradient(90deg, var(--accentSoft), #ffffff 65%);
    }
    details.comp.c1 .badge, details.comp.c2 .badge, details.comp.c3 .badge, details.comp.c4 .badge, details.comp.c5 .badge{
      border-color:#dbe2ff;
      background:#fff;
    }
    @supports (background: color-mix(in srgb, red 50%, white)){
      details.comp.c1 .badge, details.comp.c2 .badge, details.comp.c3 .badge, details.comp.c4 .badge, details.comp.c5 .badge{
        border-color: color-mix(in srgb, var(--accent) 25%, #e6e8f0);
        background: color-mix(in srgb, var(--accentSoft) 60%, #ffffff);
      }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header class="header" id="top">
      <h1 class="title">Plan d’étude cantonal — Mathématiques</h1>
      <p class="subtitle">Collège de Genève — version “web” (travail en cours)</p>
      <div class="pills" id="topPills"></div>
    </header>

    <div class="grid">
      <aside class="side">
        <h3>Sommaire</h3>
        <ul class="toc" id="toc"></ul>
      </aside>

      <main class="main" id="content"></main>
    </div>
  </div>

<script>
/* --- Données (maquette) --- */
const DATA = {
  nav: [
    { id:"competences", label:"Compétences clés" },
    { id:"progression", label:"Progression (1re → 4e)" },
    { id:"decoupages", label:"Découpages annuels" },
    { id:"acquisCO", label:"Acquis du CO" },
    { id:"phase2", label:"Phase 2 : IA & numérique" },
    { id:"phase3", label:"Phase 3 : transversalité" }
  ],

  progressionParAnnee: [
    { annee:"1re année", points:[
      "Calculer avec entiers, rationnels et réels.",
      "Résoudre équations/inéquations (1er, 2e degré + factorisation).",
      "Développer / réduire / factoriser.",
      "Représenter fonctions élémentaires (dont 1er et 2e degrés).",
      "Géométrie (angles, triangles, Pythagore, Thalès, cercles).",
      "Trigonométrie triangle rectangle."
    ]},
    { annee:"2e année", points:[
      "Géométrie cartésienne (droites, cercles).",
      "Trigonométrie triangle quelconque.",
      "Statistiques (moyenne, médiane, variance, écart-type).",
      "Équations et fonctions : polynomiales, rationnelles, exponentielles, logarithmiques, trigonométriques.",
      "Calcul vectoriel de base."
    ]},
    { annee:"3e année", points:[
      "Suites (terme général, somme arithm./géom.).",
      "Limites, dérivées, étude de fonctions, optimisation.",
      "Combinatoire.",
      "Probabilités discrètes (conditionnelle, binomiale).",
      "Produit scalaire, droites/plans (plan & espace)."
    ]},
    { annee:"4e année", points:[
      "Primitives, intégrales, problèmes via calcul intégral.",
      "Équations différentielles simples.",
      "Produit vectoriel & distances (plan/espace).",
      "Intervalles de confiance & tests statistiques.",
      "Probabilités continues (loi normale)."
    ]}
  ],

  decoupages: {
    annee: "Première année (niveau normal) — exemple",
    chapitres: [
      {
        id:"A1-CH1",
        titre:"Chapitre 1 : Calcul numérique et algébrique",
        items: [
          { titre:"Définir les ensembles de nombres (N, Z, Q → approche R), puissances entières et racines carrées", tags:["C2","CdB"] },
          { titre:"Connaître le vocabulaire et les notations du calcul numérique et de la théorie des ensembles (liste du minimum commun)", tags:["C3","CdB"] },
          { titre:"Calculer avec les nombres entiers et relatifs (priorités, parenthèses, signes, fractions)", tags:["C1","L"] },
          { titre:"Différencier nombres, constantes et variables", tags:["C2","CdB"] },
          { titre:"Lire et utiliser les notations algébriques (liste des notations communes)", tags:["C3"] },
          { titre:"Calculer avec les puissances entières et les racines carrées", tags:["C1","CdB"] },
          { titre:"Analyser la structure de termes algébriques", tags:["C3"] },
          { titre:"Effectuer des calculs algébriques : développer, réduire, factoriser", tags:["C2"] },
          { titre:"Construction mathématique : déf./conjecture/contre-exemple/démonstration/théorème/réciproque/contraposée + produire des conjectures simples", tags:["C2"] },
          { titre:"Démonstration : propriétés des puissances, racines, irrationalité de √2, identités remarquables", tags:["C2"] },
          { titre:"Éléments d’histoire des nombres et de l’algèbre (liste du minimum commun)", tags:["C4","L"] }
        ]
      }
    ]
  },

  acquisCO: [
    { bloc:"FA — Calcul littéral", items:[
      "Connaître le vocabulaire lié au calcul littéral",
      "Connaître et utiliser les conventions du calcul littéral",
      "Calculer avec monômes et polynômes",
      "Évaluer une expression littérale",
      "Transformer des formules simples (isoler une variable)",
      "Développer (identités remarquables, distributivité)",
      "Factoriser (mise en évidence, identités remarquables)",
      "Traduire programme de calcul ↔ expression littérale"
    ]},
    { bloc:"FA — Premier degré", items:[
      "Vocabulaire fonctions affines/linéaires/constantes",
      "Représenter une affine (pente & ordonnée à l’origine)",
      "Représenter une affine (2 points)",
      "Retrouver l’expression d’une affine depuis le graphe (pente fractionnaire)",
      "Parallélisme / perpendicularité",
      "Résoudre équation du 1er degré (coefficients fractionnaires)",
      "Traduire un problème en équation du 1er degré",
      "Image, préimage, intersections avec Ox/Oy"
    ]},
    { bloc:"NO — Calcul numérique", items:[
      "Calculer efficacement (4 opérations, priorités) sur entiers relatifs, décimaux, rationnels",
      "Comparer deux nombres",
      "Notation scientifique : définition + calculs",
      "Règles de calcul des puissances entières",
      "Racines carrées et cubiques + propriétés"
    ]},
    { bloc:"GM — Géométrie (Pythagore & figures)", items:[
      "Théorème de Pythagore (direct, réciproque, contraposée)",
      "Utiliser Pythagore pour longueur manquante / tester rectangle / dans l’espace",
      "Périmètres (figures simples, polygones par décomposition)",
      "Aires (figures simples, polygones par décomposition)",
      "Cercle : périmètre & aire, longueur d’arc, secteur"
    ]}
  ],

  phase2: { note:"Section indiquée comme à développer : Enjeux IA, place à donner à l’IA, ressources numériques." },
  phase3: { note:"Section indiquée comme à développer : ajout de transversalité." }
};

/* --- Helpers --- */
const elPills = document.getElementById("topPills");
const elToc   = document.getElementById("toc");
const elMain  = document.getElementById("content");

let state = { viewId: "competences", chapterFilter: new Set(["ALL"]), query: "" };

function h(tag, attrs={}, children=[]){
  const e = document.createElement(tag);
  for (const [k,v] of Object.entries(attrs)){
    if (k === "class") e.className = v;
    else if (k === "html") e.innerHTML = v;
    else if (k.startsWith("on") && typeof v === "function") e.addEventListener(k.slice(2), v);
    else e.setAttribute(k, v);
  }
  for (const c of children){
    if (c === null || c === undefined) continue;
    e.appendChild(typeof c === "string" ? document.createTextNode(c) : c);
  }
  return e;
}
function scrollToId(id){
  const target = document.getElementById(id);
  if (!target) return;
  target.scrollIntoView({behavior:"smooth", block:"start"});
}

/* --- Top pills + TOC --- */
function renderPills(){
  elPills.innerHTML = "";
  DATA.nav.forEach(n=>{
    elPills.appendChild(
      h("button", {
        class:"pill" + (state.viewId===n.id ? " active":""),
        type:"button",
        onclick: () => { state.viewId=n.id; renderAll(false); scrollToId(n.id); }
      }, [n.label])
    );
  });
}
function renderToc(){
  elToc.innerHTML = "";
  DATA.nav.forEach(n=>{
    elToc.appendChild(
      h("li", {}, [
        h("a", {href:"#"+n.id, onclick:(ev)=>{ev.preventDefault(); state.viewId=n.id; renderAll(false); scrollToId(n.id);} }, [n.label])
      ])
    );
  });
}

/* --- Sections --- */
function renderSectionCompetences(){
  return h("section", {class:"section", id:"competences"}, [
    h("div", {class:"sectionHead"}, [
      h("h2", {class:"sectionTitle"}, ["▼ Compétences clés en mathématiques"]),
      h("p", {class:"mini"}, ["Clique sur une compétence pour afficher la déclinaison (a, b, c…)."])
    ]),

    h("div", {class:"competences"}, [
      h("details", {class:"comp c1", open:true}, [
        h("summary", {}, [
          h("div", {class:"compLeft"}, [
            h("span", {class:"chev"}, ["▶"]),
            h("p", {class:"compTitle"}, ["C1 — Raisonner de façon argumentée et rigoureuse"])
          ]),
          h("span", {class:"badge"}, ["C1"])
        ]),
        h("div", {class:"compBody"}, [
          h("ol", {class:"subpoints", type:"a"}, [
            h("li", {}, ["Acquérir les bases de la démarche déductive : définition, axiome, conjecture, démonstration, théorème, hypothèse, conclusion, contre-exemple, implication, réciproque, contraposée."]),
            h("li", {}, ["Être capable de comprendre, critiquer et restituer un raisonnement mathématique ou logique."]),
            h("li", {}, ["Produire une pensée logique et abstraite structurée."])
          ])
        ])
      ]),

      h("div", {class:"trait"}, []),

      h("details", {class:"comp c2"}, [
        h("summary", {}, [
          h("div", {class:"compLeft"}, [
            h("span", {class:"chev"}, ["▶"]),
            h("p", {class:"compTitle"}, ["C2 — Maîtriser les savoir-faire techniques en mathématiques"])
          ]),
          h("span", {class:"badge"}, ["C2"])
        ]),
        h("div", {class:"compBody"}, [
          h("ol", {class:"subpoints", type:"a"}, [
            h("li", {}, ["Savoir utiliser les fondamentaux de niveau gymnasial en arithmétique, algèbre, analyse, géométrie, logique, probabilités et statistiques."]),
            h("li", {}, ["Développer des stratégies pour porter un regard critique dynamique sur un processus de résolution : prévoir, analyser et vérifier la cohérence d’un résultat."]),
            h("li", {}, ["Utiliser efficacement les moyens numériques à disposition."])
          ])
        ])
      ]),

      h("div", {class:"trait"}, []),

      h("details", {class:"comp c3"}, [
        h("summary", {}, [
          h("div", {class:"compLeft"}, [
            h("span", {class:"chev"}, ["▶"]),
            h("p", {class:"compTitle"}, ["C3 — Appréhender un problème à l’aide des outils mathématiques"])
          ]),
          h("span", {class:"badge"}, ["C3"])
        ]),
        h("div", {class:"compBody"}, [
          h("ol", {class:"subpoints", type:"a"}, [
            h("li", {}, ["Modéliser un problème en mobilisant le registre adéquat (schématique, algébrique, graphique)."]),
            h("li", {}, ["Appliquer des méthodes standards de résolution de problèmes (se ramener à un cas connu, étudier un cas particulier, introduire un élément auxiliaire, etc.) et choisir les savoir-faire techniques adéquats."]),
            h("li", {}, ["Porter un regard critique et interpréter des résultats dans différents contextes (notamment évaluer la précision attendue) dans une réponse (valeur exacte, arrondi, chiffres significatifs)."])
          ])
        ])
      ]),

      h("div", {class:"trait"}, []),

      h("details", {class:"comp c4"}, [
        h("summary", {}, [
          h("div", {class:"compLeft"}, [
            h("span", {class:"chev"}, ["▶"]),
            h("p", {class:"compTitle"}, ["C4 — Communiquer à l’écrit et à l’oral en s’appuyant sur le langage symbolique et graphique"])
          ]),
          h("span", {class:"badge"}, ["C4"])
        ]),
        h("div", {class:"compBody"}, [
          h("ol", {class:"subpoints", type:"a"}, [
            h("li", {}, ["Utiliser de façon précise les notations, symboles et définitions mathématiques selon les conventions définies par la Commission Romande de Mathématique."]),
            h("li", {}, ["Utiliser les différents registres de représentations (graphique, algébrique, schématique et textuel) selon leur pertinence."]),
            h("li", {}, ["Produire une argumentation claire et structurée, à l’écrit et à l’oral."])
          ])
        ])
      ]),

      h("div", {class:"trait"}, []),

      h("details", {class:"comp c5"}, [
        h("summary", {}, [
          h("div", {class:"compLeft"}, [
            h("span", {class:"chev"}, ["▶"]),
            h("p", {class:"compTitle"}, ["C5 — Inscrire les mathématiques dans l’histoire, identifier des liens avec les autres disciplines et des enjeux actuels"])
          ]),
          h("span", {class:"badge"}, ["C5"])
        ]),
        h("div", {class:"compBody"}, [
          h("ol", {class:"subpoints", type:"a"}, [
            h("li", {}, ["Transposer les mathématiques dans les autres disciplines (en particulier biologie, chimie, économie, géographie, informatique, physique)."]),
            h("li", {}, ["Avoir une vision des mathématiques dans une perspective historique (connaître quelques grandes étapes et personnages historiques)."]),
            h("li", {}, ["Avoir une vision des mathématiques dans une perspective sociale, de leur utilité et des applications possibles, y compris en termes d’enjeux sociaux."]),
            h("li", {}, ["Développer une sensibilité à l’élégance intrinsèque des mathématiques."])
          ])
        ])
      ])
    ])
  ]);
}

function renderSectionProgression(){
  return h("section", {class:"section", id:"progression"}, [
    h("div", {class:"sectionHead"}, [
      h("h2", {class:"sectionTitle"}, ["▼ Progression (1re → 4e)"]),
      h("div", {class:"muted"}, [""])
    ]),
    h("p", {class:"mini"}, ["Vue synthèse par année (à enrichir)."]),
    ...DATA.progressionParAnnee.map(a =>
      h("details", {class:"accordion", open:false}, [
        h("summary", {}, [a.annee, h("span",{class:"muted"},["▼"])]),
        h("div", {class:"accBody"}, [
          h("ul", {class:"bullets"}, a.points.map(x=>h("li",{},[x])))
        ])
      ])
    )
  ]);
}

function normalizeTags(tags){ return tags.map(t=>t.trim()); }
function itemMatchesFilters(item){
  const q = state.query.trim().toLowerCase();
  if (q && !item.titre.toLowerCase().includes(q)) return false;

  const active = [...state.chapterFilter];
  if (active.includes("ALL")) return true;

  const tags = normalizeTags(item.tags || []);
  return active.some(f => tags.includes(f));
}

function renderSectionDecoupages(){
  const chapter = DATA.decoupages.chapitres[0];
  const allFilters = ["ALL","C1","C2","C3","C4","C5","CdB","L","T","N"];

  return h("section", {class:"section", id:"decoupages"}, [
    h("div", {class:"sectionHead"}, [
      h("h2", {class:"sectionTitle"}, ["▼ Découpages annuels / Vues dynamiques"]),
      h("div", {class:"muted"}, [""])
    ]),
    h("p", {class:"mini"}, [
      DATA.decoupages.annee, " — ", h("span",{class:"k"},["exemple"]), " : filtrage par compétence / tags."
    ]),
    h("details", {class:"accordion", open:true}, [
      h("summary", {}, [chapter.titre, h("span",{class:"muted"},["▲"])]),
      h("div", {class:"accBody"}, [
        h("div", {class:"searchRow"}, [
          h("input", {
            type:"search",
            placeholder:"Rechercher dans le chapitre… (ex: “racines”, “démonstration”)",
            value: state.query,
            oninput:(ev)=>{ state.query = ev.target.value; renderAll(false); }
          }),
          h("span", {class:"muted"}, ["Astuce : clique sur C1/C2/… pour reproduire les “Vues disponibles”."])
        ]),
        h("div", {class:"chips"}, allFilters.map(f => {
          const active = state.chapterFilter.has(f);
          return h("button", {
            class:"chip" + (active ? " active":""),
            type:"button",
            onclick:()=>{
              if (f === "ALL"){
                state.chapterFilter = new Set(["ALL"]);
              } else {
                if (state.chapterFilter.has("ALL")) state.chapterFilter.delete("ALL");
                if (state.chapterFilter.has(f)) state.chapterFilter.delete(f);
                else state.chapterFilter.add(f);
                if (state.chapterFilter.size === 0) state.chapterFilter.add("ALL");
              }
              renderAll(false);
            }
          }, [f]);
        })),
        h("div", {class:"items", id:"chapterItems"})
      ])
    ])
  ]);
}

function renderChapterItems(){
  const holder = document.getElementById("chapterItems");
  if (!holder) return;
  holder.innerHTML = "";

  const chapter = DATA.decoupages.chapitres[0];
  const filtered = chapter.items.filter(itemMatchesFilters);

  holder.appendChild(
    h("p", {class:"mini"}, [
      "Résultats : ",
      h("strong", {}, [String(filtered.length)]),
      " / ",
      String(chapter.items.length),
      " — filtres actifs : ",
      h("span",{class:"k"}, [[...state.chapterFilter].join(", ")]),
      state.query.trim() ? (" — recherche : “" + state.query.trim() + "”") : ""
    ])
  );

  filtered.forEach(it=>{
    holder.appendChild(
      h("div", {class:"item"}, [
        h("div", {class:"itemTop"}, [
          h("p", {class:"itemTitle"}, [it.titre]),
          h("div", {class:"badges"}, (it.tags||[]).map(t=>h("span",{class:"badge"},[t])))
        ])
      ])
    );
  });

  if (filtered.length === 0){
    holder.appendChild(h("div",{class:"note"},[
      "Aucun item ne correspond à ces filtres/recherche. ",
      h("span",{class:"muted"},["(Essaie ALL ou enlève un filtre.)"])
    ]));
  }
}

function renderSectionAcquisCO(){
  return h("section", {class:"section", id:"acquisCO"}, [
    h("div", {class:"sectionHead"}, [
      h("h2", {class:"sectionTitle"}, ["▼ Acquis du CO (référence)"]),
      h("div", {class:"muted"}, [""])
    ]),
    h("p", {class:"mini"}, ["Référentiel d’entrée (acquis avant le collège)."]),
    ...DATA.acquisCO.map(b =>
      h("details", {class:"accordion", open:false}, [
        h("summary", {}, [b.bloc, h("span",{class:"muted"},["▼"])]),
        h("div", {class:"accBody"}, [
          h("ul", {class:"bullets"}, b.items.map(x=>h("li",{},[x])))
        ])
      ])
    )
  ]);
}

function renderSectionPhase2(){
  return h("section", {class:"section", id:"phase2"}, [
    h("div", {class:"sectionHead"}, [
      h("h2", {class:"sectionTitle"}, ["▼ Phase 2 : IA et numérique"]),
      h("div", {class:"muted"}, [""])
    ]),
    h("div", {class:"note"}, [DATA.phase2.note])
  ]);
}
function renderSectionPhase3(){
  return h("section", {class:"section", id:"phase3"}, [
    h("div", {class:"sectionHead"}, [
      h("h2", {class:"sectionTitle"}, ["▼ Phase 3 : transversalité"]),
      h("div", {class:"muted"}, [""])
    ]),
    h("div", {class:"note"}, [DATA.phase3.note])
  ]);
}

/* --- Render all --- */
function renderAll(doScroll){
  renderPills();
  renderToc();

  elMain.innerHTML = "";
  elMain.appendChild(renderSectionCompetences());
  elMain.appendChild(renderSectionProgression());
  elMain.appendChild(renderSectionDecoupages());
  elMain.appendChild(renderSectionAcquisCO());
  elMain.appendChild(renderSectionPhase2());
  elMain.appendChild(renderSectionPhase3());

  renderChapterItems();

  if (doScroll) scrollToId(state.viewId);
}

/* Interactions : 1 compétence ouverte à la fois */
function wireCompetences(){
  document.querySelectorAll('details.comp').forEach(d => {
    d.addEventListener('toggle', () => {
      if (!d.open) return;
      document.querySelectorAll('details.comp').forEach(other => {
        if (other !== d) other.open = false;
      });
    });
  });
}

/* Init */
renderAll(false);
wireCompetences();
</script>
</body>
</html>
