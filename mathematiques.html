<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Plan d‚Äô√©tude cantonal ‚Äî Math√©matiques (maquette)</title>

  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --border:#e6e8f0;
      --text:#111827;
      --muted:#6b7280;
      --shadow:0 10px 30px rgba(17,24,39,.06);
      --radius:16px;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;

      --pill-bg:#f8fafc;
      --pill-hover:#eef2ff;
      --pill-active:#e0e7ff;
      --pill-ring:#c7d2fe;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:var(--bg);
      line-height:1.45;
    }
    .wrap{max-width:1100px;margin:24px auto;padding:0 16px 40px;}
    .header{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:18px 18px 14px;
      box-shadow:var(--shadow);
    }
    .title{margin:0 0 4px;font-size:24px;letter-spacing:-0.02em}
    .subtitle{margin:0;color:var(--muted);font-size:14px}

    /* Pills */
    .pills{display:flex;flex-wrap:wrap;gap:8px;padding:10px 0 2px}
    .pill-btn{
      appearance:none;
      border:1px solid var(--border);
      background: var(--pill-bg);
      color: var(--text);
      font-size: 13px;
      padding: 7px 10px;
      border-radius: 999px;
      cursor:pointer;
      transition: background .15s ease, border-color .15s ease, transform .05s ease;
      white-space:nowrap;
    }
    .pill-btn:hover{ background: var(--pill-hover); border-color: var(--pill-ring); }
    .pill-btn:active{ transform: translateY(1px); }
    .pill-btn[aria-current="true"]{
      background: var(--pill-active);
      border-color: var(--pill-ring);
      box-shadow: 0 0 0 3px rgba(199,210,254,.35);
      font-weight:700;
    }

    /* Layout */
    .grid{
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:16px;
      margin-top:16px;
      align-items:start;
    }
    @media (max-width: 980px){ .grid{grid-template-columns:1fr} }

    /* Sidebar */
    .side{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
      position:sticky;
      top:16px;
    }
    @media (max-width: 980px){ .side{position:relative; top:auto} }
    .sideTop{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .side h3{margin:6px 0 10px;font-size:14px}
    .sideBtns{display:flex;gap:8px}
    .sideBtn{
      border:1px solid var(--border);
      background:#fff;
      border-radius:10px;
      padding:7px 10px;
      font-size:12px;
      cursor:pointer;
      color:#374151;
    }
    .sideBtn:hover{background:#f3f6ff; border-color:#cfe0ff}
    #tocWrap.isHidden{display:none}
    .toc{margin:0;padding-left:16px;font-size:14px}
    .toc li{margin:6px 0}
    .toc a{color:#1d4ed8;text-decoration:none}
    .toc a:hover{text-decoration:underline}

    /* Sidebar mini (horizontal collapse) */
    .grid.sidebarMini{ grid-template-columns:72px 1fr; }
    .grid.sidebarMini .side{ padding:10px; }
    .grid.sidebarMini .side h3,
    .grid.sidebarMini #tocWrap{ display:none; }
    .grid.sidebarMini .resourcesPanel{ display:none !important; }
    .grid.sidebarMini .sideTop{ justify-content:center; }
    .grid.sidebarMini .sideBtns{ flex-direction:column; }

    /* Resources panel */
    .resourcesPanel{
      margin-top:12px;
      border-top:1px solid var(--border);
      padding-top:12px;
    }
    .resHead{
      display:flex;align-items:flex-start;justify-content:space-between;gap:10px;
      margin-bottom:10px;
    }
    .resTitle{font-weight:800;font-size:14px}
    .resSub{color:var(--muted);font-size:12px;margin-top:2px}
    .resList{display:flex;flex-direction:column;gap:8px}
    .resItem{
      display:flex;gap:10px;align-items:flex-start;
      border:1px solid var(--border);
      border-radius:12px;
      padding:10px;background:#fff;
    }
    .resIcon{
      width:34px;height:34px;border-radius:10px;border:1px solid var(--border);
      display:flex;align-items:center;justify-content:center;
      background:#fbfcff;font-size:16px;flex:0 0 auto;
    }
    .resBody{min-width:0}
    .resName{font-weight:700;margin:0;font-size:13px}
    .resMeta{margin:2px 0 0;color:var(--muted);font-size:12px}
    .resLink{
      display:inline-block;margin-top:6px;font-size:12px;
      color:#1d4ed8;text-decoration:none;
    }
    .resLink:hover{text-decoration:underline}

    /* Main */
    .main{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
    }
    .section{
      border:1px solid var(--border);
      border-radius:var(--radius);
      background:#fff;
      padding:14px;
      margin-bottom:14px;
    }
    .sectionHead{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      margin-bottom:10px;
    }
    .sectionTitle{
      display:flex;align-items:center;gap:10px;
      margin:0;font-weight:900;font-size:20px;letter-spacing:-0.02em;
    }
    .mini{margin:0;color:var(--muted);font-size:13px}

    /* Competences (accordion cards like screenshot) */
    details.comp{
      border:1px solid var(--border);
      border-radius:14px;
      background:#fff;
      overflow:hidden;
      margin:10px 0;
    }
    details.comp > summary{
      list-style:none;
      cursor:pointer;
      user-select:none;
      padding:12px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      font-weight:900;
      letter-spacing:-0.01em;
    }
    details.comp > summary::-webkit-details-marker{display:none}
    .compLeft{display:flex;align-items:flex-start;gap:10px;min-width:0}
    .chev{width:18px;height:18px;display:inline-flex;align-items:center;justify-content:center;color:var(--muted);transform:translateY(2px);font-size:14px}
    details.comp[open] .chev{ transform: translateY(2px) rotate(90deg); }
    .compTitle{margin:0;font-size:15px;line-height:1.25}
    .badge{
      font-family:var(--mono);
      font-size:12px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid var(--border);
      background:#fff;color:#111827;
      white-space:nowrap;
    }
    .compBody{padding:0 12px 12px}
    .subpoints{margin:8px 0 0;padding-left:20px;font-size:14px}
    .subpoints li{margin:8px 0}
    .trait{height:1px;background:linear-gradient(to right, transparent, #e6e8f0, transparent);margin:10px 0;}

    /* Competence accents */
    .c1{ --accent:#2563eb; --accentSoft:#e8efff; }
    .c2{ --accent:#16a34a; --accentSoft:#e8fff1; }
    .c3{ --accent:#f59e0b; --accentSoft:#fff6e6; }
    .c4{ --accent:#7c3aed; --accentSoft:#f3e8ff; }
    .c5{ --accent:#ef4444; --accentSoft:#ffecec; }
    details.comp.c1 > summary,
    details.comp.c2 > summary,
    details.comp.c3 > summary,
    details.comp.c4 > summary,
    details.comp.c5 > summary{
      background: linear-gradient(90deg, var(--accentSoft), #ffffff 65%);
    }
    @supports (background: color-mix(in srgb, red 50%, white)){
      details.comp.c1 .badge,
      details.comp.c2 .badge,
      details.comp.c3 .badge,
      details.comp.c4 .badge,
      details.comp.c5 .badge{
        border-color: color-mix(in srgb, var(--accent) 25%, #e6e8f0);
        background: color-mix(in srgb, var(--accentSoft) 60%, #ffffff);
      }
    }

    /* Progression: year accents */
    .y1{ --yearAccent:#2563eb; --yearSoft:#e8efff; }
    .y2{ --yearAccent:#16a34a; --yearSoft:#e8fff1; }
    .y3{ --yearAccent:#f59e0b; --yearSoft:#fff6e6; }
    .y4{ --yearAccent:#7c3aed; --yearSoft:#f3e8ff; }

    .yearGrid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:12px;margin-top:12px;
    }
    @media (max-width: 720px){ .yearGrid{ grid-template-columns:1fr; } }
    .yearTile{
      border:1px solid var(--border);
      border-radius:14px;
      background:#fff;
      padding:14px;
      cursor:pointer;
      position:relative;
      overflow:hidden;
      transition: transform .12s ease, border-color .12s ease, box-shadow .12s ease;
    }
    .yearTile::before{content:"";position:absolute;left:0;top:0;bottom:0;width:6px;background:var(--yearAccent);}
    .yearTile:hover{transform:translateY(-2px);border-color:#cfe0ff;box-shadow:0 14px 30px rgba(17,24,39,.08);}
    .yearTileTitle{margin:0;font-weight:950;font-size:16px;letter-spacing:-0.01em}
    .yearTileSub{margin:6px 0 0;color:var(--muted);font-size:13px}
    .yearTileTag{
      display:inline-flex;align-items:center;gap:6px;margin-top:10px;
      font-size:12px;color:#374151;padding:4px 8px;border-radius:999px;
      border:1px solid var(--border);
      background: color-mix(in srgb, var(--yearSoft) 55%, #ffffff);
    }

    .yearNavBar{
      display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;
      margin-top:10px;padding:10px;border:1px solid var(--border);border-radius:14px;
      background: linear-gradient(90deg, var(--yearSoft), #ffffff 70%);
    }
    .backLink{
      border:none;background:transparent;color:#1d4ed8;cursor:pointer;
      padding:6px 8px;border-radius:10px;font-size:13px;
    }
    .backLink:hover{background:rgba(29,78,216,.08);}
    .yearBtns{display:flex;gap:8px;flex-wrap:wrap;}
    .yearBtn{
      border:1px solid var(--border);background:#fff;border-radius:999px;
      padding:7px 10px;cursor:pointer;font-size:13px;color:#374151;
      transition:.12s background, .12s border-color, .12s transform;
    }
    .yearBtn:hover{transform:translateY(-1px);border-color:#cfe0ff;background:#f3f6ff;}
    .yearBtn.active{
      border-color: color-mix(in srgb, var(--yearAccent) 35%, var(--border));
      background: color-mix(in srgb, var(--yearSoft) 70%, #ffffff);
      color:#111827;font-weight:800;
    }

    .progressGrid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:12px;margin-top:12px;align-items:stretch;
    }
    @media (max-width: 720px){ .progressGrid{ grid-template-columns:1fr; } }
    .progCard{
      border:1px solid var(--border);
      border-radius:14px;background:#fff;overflow:hidden;cursor:pointer;position:relative;
      transition: transform .12s ease, border-color .12s ease, box-shadow .12s ease;
    }
    .progCard:hover{transform:translateY(-2px);box-shadow:0 14px 30px rgba(17,24,39,.08);border-color:#cfe0ff;}
    .progCard::before{content:"";position:absolute;left:0;top:0;bottom:0;width:5px;background:var(--accent);}
    .progCardHead{
      padding:12px 12px 10px;display:flex;align-items:flex-start;justify-content:space-between;gap:10px;
      border-bottom:1px solid var(--border);
      background: linear-gradient(90deg, var(--accentSoft), #ffffff 70%);
    }
    .progCardTitle{margin:0;font-weight:950;font-size:14px;line-height:1.2}
    .progCardSub{margin:4px 0 0;color:var(--muted);font-size:12px}
    .progCardBody{padding:10px 12px 12px}
    .progList{margin:0;padding-left:18px;font-size:13px}
    .progList li{margin:6px 0}
  </style>
</head>

<body>
  <div class="wrap">
    <header class="header" id="top">
      <h1 class="title">Plan d‚Äô√©tude cantonal ‚Äî Math√©matiques</h1>
      <p class="subtitle">Coll√®ge de Gen√®ve ‚Äî version ‚Äúweb‚Äù (travail en cours)</p>

      <div class="pills" id="topPills"></div>
    </header>

    <div class="grid" id="grid">
      <aside class="side" id="sidebar">
        <div class="sideTop">
          <h3>Sommaire</h3>
          <div class="sideBtns">
            <button class="sideBtn" id="btnCollapseV" type="button">Replier</button>
            <button class="sideBtn" id="btnCollapseH" type="button">‚áî</button>
          </div>
        </div>

        <div id="tocWrap">
          <ul class="toc" id="toc"></ul>
        </div>

        <div class="resourcesPanel" id="resourcesPanel" hidden>
          <div class="resHead">
            <div>
              <div class="resTitle">Ressources</div>
              <div class="resSub" id="resFor">Pour : ‚Äî</div>
            </div>
            <button class="sideBtn" id="btnCloseRes" type="button">Fermer</button>
          </div>
          <div class="resList" id="resList"></div>
        </div>
      </aside>

      <main class="main" id="main">
        <section class="section" id="competences">
          <div class="sectionHead">
            <h2 class="sectionTitle">‚ñº Comp√©tences cl√©s en math√©matiques</h2>
            <p class="mini">Cliquez sur une comp√©tence pour afficher la d√©clinaison (a, b, c...).</p>
          </div>

          <div id="competencesMount"></div>
        </section>

        <section class="section" id="progression">
          <div class="sectionHead">
            <h2 class="sectionTitle">‚ñº Progression (1re ‚Üí 4e)</h2>
            <p class="mini">Cliquez une ann√©e (grille), puis basculez via les boutons.</p>
          </div>
          <div id="progressionMount"></div>
        </section>

        <section class="section" id="decoupages">
          <div class="sectionHead">
            <h2 class="sectionTitle">‚ñº D√©coupages annuels</h2>
            <p class="mini">Section d√©mo (√† enrichir).</p>
          </div>
          <p style="margin:0;color:var(--muted);font-size:13px;">Contenu √† d√©finir : chapitres, objectifs, liens C1‚ÄìC5, etc.</p>
        </section>

        <section class="section" id="acquis">
          <div class="sectionHead">
            <h2 class="sectionTitle">‚ñº Acquis du CO</h2>
            <p class="mini">Section d√©mo (√† enrichir).</p>
          </div>
          <p style="margin:0;color:var(--muted);font-size:13px;">Contenu √† int√©grer : acquis CdBA / NO / GM‚Ä¶</p>
        </section>

        <section class="section" id="phase2">
          <div class="sectionHead">
            <h2 class="sectionTitle">‚ñº Phase 2 : IA & num√©rique</h2>
            <p class="mini">Section d√©mo (√† enrichir).</p>
          </div>
          <ul style="margin:0;padding-left:18px;font-size:13px;">
            <li>Enjeux li√©s √† l‚ÄôIA</li>
            <li>Place √† donner √† l‚ÄôIA</li>
            <li>Ressources num√©riques</li>
          </ul>
        </section>

        <section class="section" id="phase3">
          <div class="sectionHead">
            <h2 class="sectionTitle">‚ñº Phase 3 : transversalit√©</h2>
            <p class="mini">Section d√©mo (√† enrichir).</p>
          </div>
          <p style="margin:0;color:var(--muted);font-size:13px;">Contenu √† d√©finir.</p>
        </section>
      </main>
    </div>
  </div>

  <script>
    // -----------------------
    // Helpers
    // -----------------------
    function h(tag, attrs={}, children=[]){
      const el = document.createElement(tag);
      for(const [k,v] of Object.entries(attrs||{})){
        if(k === "class") el.className = v;
        else if(k.startsWith("on") && typeof v === "function") el.addEventListener(k.slice(2), v);
        else if(v === true) el.setAttribute(k, "");
        else if(v !== false && v != null) el.setAttribute(k, String(v));
      }
      (children||[]).forEach(ch => {
        if(ch == null) return;
        el.appendChild(typeof ch === "string" ? document.createTextNode(ch) : ch);
      });
      return el;
    }
    function smoothScrollTo(id){
      const el = document.getElementById(id);
      if(!el) return;
      el.scrollIntoView({behavior:"smooth", block:"start"});
    }

    // -----------------------
    // Data
    // -----------------------
    const DATA = {
      nav: [
        { id:"competences", label:"Comp√©tences cl√©s" },
        { id:"progression", label:"Progression (1re ‚Üí 4e)" },
        { id:"decoupages", label:"D√©coupages annuels" },
        { id:"acquis", label:"Acquis du CO" },
        { id:"phase2", label:"Phase 2 : IA & num√©rique" },
        { id:"phase3", label:"Phase 3 : transversalit√©" },
      ],

      competences: [
        {
          code:"C1", cls:"c1",
          title:"C1 ‚Äî Raisonner de fa√ßon argument√©e et rigoureuse",
          points:[
            "Acqu√©rir les bases de la d√©marche d√©ductive : d√©finition, axiome, conjecture, d√©monstration, th√©or√®me, hypoth√®se, conclusion, contre-exemple, implication, r√©ciproque, contrapos√©e.",
            "√ätre capable de comprendre, critiquer et restituer un raisonnement math√©matique ou logique.",
            "Produire une pens√©e logique et abstraite structur√©e."
          ]
        },
        {
          code:"C2", cls:"c2",
          title:"C2 ‚Äî Ma√Ætriser les savoir-faire techniques en math√©matiques",
          points:[
            "Savoir utiliser les fondamentaux de niveau gymnasial en arithm√©tique, alg√®bre, analyse, g√©om√©trie, logique, probabilit√©s et statistiques.",
            "D√©velopper des strat√©gies pour porter un regard critique dynamique sur un processus de r√©solution : pr√©voir, analyser et v√©rifier la coh√©rence d‚Äôun r√©sultat.",
            "Utiliser efficacement les moyens num√©riques √† disposition."
          ]
        },
        {
          code:"C3", cls:"c3",
          title:"C3 ‚Äî Appr√©hender un probl√®me √† l‚Äôaide des outils math√©matiques",
          points:[
            "Mod√©liser un probl√®me en mobilisant le registre ad√©quat (sch√©matique, alg√©brique, graphique).",
            "Appliquer des m√©thodes standards de r√©solution de probl√®mes (se ramener √† un cas connu, √©tudier un cas particulier, introduire un √©l√©ment auxiliaire, etc.) et choisir les savoir-faire techniques ad√©quats.",
            "Porter un regard critique et interpr√©ter des r√©sultats dans diff√©rents contextes (notamment √©valuer la pr√©cision attendue) dans une r√©ponse (valeur exacte, arrondi, chiffres significatifs)."
          ]
        },
        {
          code:"C4", cls:"c4",
          title:"C4 ‚Äî Communiquer √† l‚Äô√©crit et √† l‚Äôoral via le langage symbolique et graphique",
          points:[
            "Utiliser de fa√ßon pr√©cise les notations, symboles et d√©finitions math√©matiques selon les conventions d√©finies par la Commission Romande de Math√©matique.",
            "Utiliser les diff√©rents registres de repr√©sentations (graphique, alg√©brique, sch√©matique et textuel) selon leur pertinence.",
            "Produire une argumentation claire et structur√©e, √† l‚Äô√©crit et √† l‚Äôoral."
          ]
        },
        {
          code:"C5", cls:"c5",
          title:"C5 ‚Äî Inscrire les math√©matiques dans l‚Äôhistoire, liens & enjeux actuels",
          points:[
            "Transposer les math√©matiques dans les autres disciplines (en particulier biologie, chimie, √©conomie, g√©ographie, informatique, physique).",
            "Avoir une vision des math√©matiques dans une perspective historique (conna√Ætre quelques grandes √©tapes et personnages historiques).",
            "Avoir une vision des math√©matiques dans une perspective sociale, de leur utilit√© et des applications possibles, y compris en termes d‚Äôenjeux sociaux.",
            "D√©velopper une sensibilit√© √† l‚Äô√©l√©gance intrins√®que des math√©matiques."
          ]
        }
      ],

      // Ressources par comp√©tence (exemples)
      ressourcesParCompetence: {
        C1: [
          { type:"pdf",   name:"Fiche ‚Äî Bases de la d√©marche d√©ductive", meta:"PDF ‚Ä¢ 6 pages", href:"#"},
          { type:"video", name:"Vid√©o ‚Äî Preuve & contre-exemple (intro)", meta:"Vid√©o ‚Ä¢ 8 min", href:"#"},
          { type:"web",   name:"Article ‚Äî R√©ciproque vs contrapos√©e", meta:"Lien web", href:"#"},
        ],
        C2: [
          { type:"pdf",   name:"M√©mo ‚Äî Techniques alg√©briques essentielles", meta:"PDF ‚Ä¢ 4 pages", href:"#"},
          { type:"web",   name:"Outil ‚Äî Calculatrice / simulateur", meta:"Lien web", href:"#"},
          { type:"video", name:"Vid√©o ‚Äî V√©rifier la coh√©rence d‚Äôun r√©sultat", meta:"Vid√©o ‚Ä¢ 5 min", href:"#"},
        ],
        C3: [
          { type:"pdf",     name:"Guide ‚Äî Mod√©liser (sch√©ma / alg√®bre / graphe)", meta:"PDF ‚Ä¢ 5 pages", href:"#"},
          { type:"activity",name:"Activit√© ‚Äî M√©thodes standards de r√©solution", meta:"Exercices ‚Ä¢ 20 min", href:"#"},
          { type:"web",     name:"Banque ‚Äî Probl√®mes contextualis√©s", meta:"Lien web", href:"#"},
        ],
        C4: [
          { type:"pdf",   name:"Conventions ‚Äî Notations (CRM)", meta:"PDF ‚Ä¢ 3 pages", href:"#"},
          { type:"video", name:"Vid√©o ‚Äî Expliquer un raisonnement √† l‚Äôoral", meta:"Vid√©o ‚Ä¢ 7 min", href:"#"},
          { type:"web",   name:"Ressource ‚Äî Choisir le bon registre", meta:"Lien web", href:"#"},
        ],
        C5: [
          { type:"web",   name:"Dossier ‚Äî Maths & autres disciplines", meta:"Lien web", href:"#"},
          { type:"pdf",   name:"Chronologie ‚Äî Grandes √©tapes historiques", meta:"PDF ‚Ä¢ 2 pages", href:"#"},
          { type:"video", name:"Vid√©o ‚Äî Enjeux sociaux des applications", meta:"Vid√©o ‚Ä¢ 10 min", href:"#"},
        ]
      },

      // Progression : ann√©es
      years: [
        { id:"y1", label:"1re ann√©e", comps:{
          C1:["a) Identifier et utiliser le vocabulaire‚Ä¶","b) Comprendre et restituer‚Ä¶","c) Structurer une argumentation courte‚Ä¶"],
          C2:["a) Utiliser les fondamentaux‚Ä¶","b) V√©rifier la coh√©rence‚Ä¶","c) Utiliser un outil num√©rique simple‚Ä¶"],
          C3:["a) Passer du texte √† un sch√©ma‚Ä¶","b) Choisir une m√©thode‚Ä¶","c) Pr√©senter une r√©ponse pr√©cise‚Ä¶"],
          C4:["a) Employer correctement notations‚Ä¶","b) Lire un graphique‚Ä¶","c) R√©diger une r√©solution pas √† pas‚Ä¶"],
          C5:["a) Identifier une utilisation‚Ä¶","b) Citer une √©tape historique‚Ä¶","c) Rep√©rer une application concr√®te‚Ä¶","d) Sensibilit√© √† l‚Äô√©l√©gance‚Ä¶"]
        }},
        { id:"y2", label:"2e ann√©e", comps:{
          C1:["a) D√©monstration courte‚Ä¶","b) Critiquer un raisonnement‚Ä¶","c) G√©n√©raliser une conjecture‚Ä¶"],
          C2:["a) Expressions plus complexes‚Ä¶","b) Strat√©gies de v√©rification‚Ä¶","c) Outil num√©rique (graphique)‚Ä¶"],
          C3:["a) Mod√©liser contextualis√©‚Ä¶","b) M√©thode standard‚Ä¶","c) Interpr√©ter dans le contexte‚Ä¶"],
          C4:["a) R√©daction structur√©e‚Ä¶","b) Tableau ‚Üî graphe ‚Üî formule‚Ä¶","c) Oral 2‚Äì3 minutes‚Ä¶"],
          C5:["a) Transposer mod√®le‚Ä¶","b) Personnages/√©tapes‚Ä¶","c) Usage des maths‚Ä¶","d) √âl√©gance‚Ä¶"]
        }},
        { id:"y3", label:"3e ann√©e", comps:{
          C1:["a) Structurer une preuve (analyse)‚Ä¶","b) Points faibles‚Ä¶","c) Argumentation logique‚Ä¶"],
          C2:["a) Techniques d‚Äôanalyse‚Ä¶","b) M√©thodes crois√©es‚Ä¶","c) Outil num√©rique‚Ä¶"],
          C3:["a) Optimisation‚Ä¶","b) Choisir une m√©thode‚Ä¶","c) Interpr√©ter‚Ä¶"],
          C4:["a) Raisonnement complet‚Ä¶","b) Plusieurs registres‚Ä¶","c) Oral argument√©‚Ä¶"],
          C5:["a) Mod√©liser physique‚Ä¶","b) Perspective historique‚Ä¶","c) Perspective sociale‚Ä¶","d) √âl√©gance‚Ä¶"]
        }},
        { id:"y4", label:"4e ann√©e", comps:{
          C1:["a) Argumenter rigoureusement‚Ä¶","b) Critiquer un raisonnement‚Ä¶","c) Construire un plan de preuve‚Ä¶"],
          C2:["a) Techniques avanc√©es‚Ä¶","b) V√©rifier coh√©rence‚Ä¶","c) CAS/graphique‚Ä¶"],
          C3:["a) Mod√©liser int√©grales/ED‚Ä¶","b) Choisir m√©thode‚Ä¶","c) Interpr√©ter‚Ä¶"],
          C4:["a) R√©daction propre‚Ä¶","b) Registres‚Ä¶","c) Oral complet‚Ä¶"],
          C5:["a) Transposer disciplines‚Ä¶","b) Perspective historique‚Ä¶","c) Perspective sociale‚Ä¶","d) √âl√©gance‚Ä¶"]
        }},
      ],

      compTitles: {
        C1: "Comp√©tence 1 : Raisonner de fa√ßon argument√©e et rigoureuse",
        C2: "Comp√©tence 2 : Ma√Ætriser les savoir-faire techniques en math√©matiques",
        C3: "Comp√©tence 3 : Appr√©hender un probl√®me √† l‚Äôaide des outils math√©matiques",
        C4: "Comp√©tence 4 : Communiquer √† l'√©crit et √† l'oral en s'appuyant sur le langage symbolique et graphique",
        C5: "Comp√©tence 5 : Inscrire les math√©matiques dans l‚Äôhistoire, identifier des liens avec les autres disciplines et des enjeux actuels",
      }
    };

    // -----------------------
    // Sidebar behavior
    // -----------------------
    document.getElementById("btnCollapseV").addEventListener("click", ()=>{
      const tocWrap = document.getElementById("tocWrap");
      const isHidden = tocWrap.classList.toggle("isHidden");
      document.getElementById("btnCollapseV").textContent = isHidden ? "D√©plier" : "Replier";
    });
    document.getElementById("btnCollapseH").addEventListener("click", ()=>{
      document.getElementById("grid").classList.toggle("sidebarMini");
    });

    // -----------------------
    // Resources
    // -----------------------
    function iconFor(type){
      if(type==="pdf") return "üìÑ";
      if(type==="video") return "‚ñ∂Ô∏è";
      if(type==="web") return "üîó";
      if(type==="activity") return "üß©";
      return "üìå";
    }

    function hideResources(){
      document.getElementById("resourcesPanel").hidden = true;
    }
    document.getElementById("btnCloseRes").addEventListener("click", hideResources);

    function showResourcesFor(compCode){
      const panel = document.getElementById("resourcesPanel");
      const list  = document.getElementById("resList");
      const resFor= document.getElementById("resFor");

      const res = (DATA.ressourcesParCompetence && DATA.ressourcesParCompetence[compCode]) || [];
      if(res.length === 0){
        panel.hidden = true;
        return;
      }

      resFor.textContent = `Pour : ${compCode}`;
      list.innerHTML = "";
      res.forEach(r=>{
        list.appendChild(
          h("div",{class:"resItem"},[
            h("div",{class:"resIcon", title:r.type},[iconFor(r.type)]),
            h("div",{class:"resBody"},[
              h("p",{class:"resName"},[r.name]),
              h("p",{class:"resMeta"},[r.meta || ""]),
              h("a",{class:"resLink", href:r.href || "#", target:"_blank", rel:"noopener"},["Ouvrir"])
            ])
          ])
        );
      });

      panel.hidden = false;

      // Si la sidebar est ‚Äúmini‚Äù, on la r√©-ouvre pour voir les ressources
      const grid = document.getElementById("grid");
      if(grid.classList.contains("sidebarMini")) grid.classList.remove("sidebarMini");
    }
    // rendre accessible globalement si besoin
    window.showResourcesFor = showResourcesFor;

    // -----------------------
    // Render: top pills + toc
    // -----------------------
    function renderNav(){
      const pills = document.getElementById("topPills");
      pills.innerHTML = "";
      DATA.nav.forEach((it, idx)=>{
        const btn = h("button", {
          class:"pill-btn",
          type:"button",
          "data-id": it.id,
          "aria-current": idx===0 ? "true" : "false",
          onclick: ()=>{
            setActivePill(it.id);
            smoothScrollTo(it.id);
          }
        }, [it.label]);
        pills.appendChild(btn);
      });

      const toc = document.getElementById("toc");
      toc.innerHTML = "";
      DATA.nav.forEach(it=>{
        toc.appendChild(h("li",{},[
          h("a",{href:"#"+it.id, onclick:(e)=>{e.preventDefault(); setActivePill(it.id); smoothScrollTo(it.id);} },[it.label])
        ]));
      });
    }

    function setActivePill(id){
      document.querySelectorAll("#topPills .pill-btn").forEach(b=>{
        b.setAttribute("aria-current", b.getAttribute("data-id") === id ? "true" : "false");
      });
    }

    // -----------------------
    // Render: Competences
    // -----------------------
    function renderCompetences(){
      const mount = document.getElementById("competencesMount");
      mount.innerHTML = "";

      DATA.competences.forEach((c, idx)=>{
        const det = h("details", {class:`comp ${c.cls}`, "data-comp": c.code, open: idx===0}, [
          h("summary",{},[
            h("div",{class:"compLeft"},[
              h("span",{class:"chev"},["‚ñ∂"]),
              h("p",{class:"compTitle"},[c.title]),
            ]),
            h("span",{class:"badge"},[c.code])
          ]),
          h("div",{class:"compBody"},[
            h("ol",{class:"subpoints", type:"a"}, c.points.map(p=>h("li",{},[p])))
          ])
        ]);

        det.addEventListener("toggle", ()=>{
          if(det.open){
            // 1 ouvert √† la fois
            mount.querySelectorAll("details.comp").forEach(o=>{ if(o!==det) o.open=false; });
            showResourcesFor(c.code);
          } else {
            hideResources();
          }
        });

        mount.appendChild(det);

        if(idx < DATA.competences.length-1) mount.appendChild(h("div",{class:"trait"}));
      });
    }

    // -----------------------
    // Render: Progression (year grid -> detail)
    // -----------------------
    let progressionState = { selectedYear: null };

    function yearClassFromId(id){ return id; } // y1..y4 matches CSS classes

    function renderYearGrid(mount){
      const grid = h("div",{class:"yearGrid"},[]);
      DATA.years.forEach(y=>{
        const tile = h("div",{class:`yearTile ${yearClassFromId(y.id)}`, role:"button", tabindex:"0"},[
          h("p",{class:"yearTileTitle"},[y.label]),
          h("p",{class:"yearTileSub"},["Voir les sous-comp√©tences par comp√©tence (C1‚Ä¶C5)"]),
          h("span",{class:"yearTileTag"},["Ouvrir la vue d√©taill√©e"])
        ]);
        const open = ()=>{
          progressionState.selectedYear = y.id;
          renderProgression();
        };
        tile.addEventListener("click", open);
        tile.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); open(); }});
        grid.appendChild(tile);
      });
      mount.appendChild(grid);
    }

    function renderYearDetail(mount, yearObj){
      const wrap = h("div",{class: yearClassFromId(yearObj.id)},[]);

      // Nav bar
      const nav = h("div",{class:"yearNavBar"},[
        h("button",{class:"backLink", type:"button", onclick:()=>{
          progressionState.selectedYear = null;
          renderProgression();
        }},["‚Üê Retour aux ann√©es"]),
        h("div",{class:"yearBtns", id:"yearBtns"},[])
      ]);
      const btns = nav.querySelector("#yearBtns");
      DATA.years.forEach(y=>{
        btns.appendChild(
          h("button",{
            class:"yearBtn"+(y.id===yearObj.id ? " active" : ""),
            type:"button",
            onclick:()=>{
              progressionState.selectedYear = y.id;
              renderProgression();
            }
          },[y.label])
        );
      });

      wrap.appendChild(nav);

      // Cards
      const grid = h("div",{class:"progressGrid"},[]);
      ["C1","C2","C3","C4","C5"].forEach(code=>{
        const subs = yearObj.comps?.[code];
        if(!subs || subs.length===0) return;

        const card = h("div",{class:`progCard ${code.toLowerCase()}`, role:"button", tabindex:"0"},[
          h("div",{class:"progCardHead"},[
            h("div",{},[
              h("p",{class:"progCardTitle"},[DATA.compTitles[code] || code]),
              h("p",{class:"progCardSub"},[yearObj.label])
            ]),
            h("span",{class:"progBadge"},[code])
          ]),
          h("div",{class:"progCardBody"},[
            h("ul",{class:"progList"}, subs.map(x=>h("li",{},[x])))
          ])
        ]);

        const openRes = ()=>showResourcesFor(code);
        card.addEventListener("click", openRes);
        card.addEventListener("keydown",(e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); openRes(); }});

        grid.appendChild(card);
      });

      wrap.appendChild(grid);
      mount.appendChild(wrap);
    }

    function renderProgression(){
      const mount = document.getElementById("progressionMount");
      mount.innerHTML = "";

      if(progressionState.selectedYear == null){
        renderYearGrid(mount);
        return;
      }
      const y = DATA.years.find(x=>x.id===progressionState.selectedYear) || DATA.years[0];
      renderYearDetail(mount, y);
    }

    // -----------------------
    // Init
    // -----------------------
    renderNav();
    renderCompetences();
    renderProgression();

    // Bonus: set pill active on scroll (simple)
    const sections = DATA.nav.map(x=>document.getElementById(x.id)).filter(Boolean);
    const obs = new IntersectionObserver((entries)=>{
      const visible = entries.filter(e=>e.isIntersecting).sort((a,b)=>b.intersectionRatio-a.intersectionRatio)[0];
      if(visible && visible.target?.id) setActivePill(visible.target.id);
    }, {root:null, threshold:[0.2,0.35,0.5]});
    sections.forEach(s=>obs.observe(s));
  </script>
</body>
</html>
